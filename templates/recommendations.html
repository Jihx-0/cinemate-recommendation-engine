{% extends "base.html" %}

{% block title %}Your Recommendations - Lumora{% endblock %}

{% block content %}
<div class="recommendations-section">
    <div class="container">
        <h1 class="page-title">Your Movie Recommendations</h1>
        <p class="page-description">
            Based on your ratings, here are movies we think you'll love. Our AI analyzes your preferences 
            to find hidden gems and popular favorites that match your taste.
        </p>
        
        {% if error %}
        <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i>
            {{ error }}
        </div>
        {% endif %}
        
        {% if user_ratings %}
        <div class="user-ratings-summary">
            <h3>Your Ratings</h3>
            <div class="ratings-grid">
                {% for movie_id, rating in user_ratings.items() %}
                {% set movie = movies|selectattr("movie_id", "equalto", movie_id)|first %}
                {% if movie %}
                <div class="rating-item">
                    <span class="movie-title-small">{{ movie.title }}</span>
                    <div class="rating-stars">
                        {% for i in range(1, 6) %}
                        <span class="{% if i <= rating %}filled{% endif %}">â˜…</span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        {% if recommendations %}
        <div class="recommendations-grid">
            {% for movie in recommendations %}
            <div class="recommendation-card">
                {% if movie.poster_url %}
                <img src="{{ movie.poster_url }}" alt="{{ movie.title }}" class="movie-poster-large poster-image-large">
                {% else %}
                <div class="movie-poster-large">
                    <i class="fas fa-film"></i>
                </div>
                {% endif %}
                
                <div class="movie-content">
                    <div class="movie-meta">
                        {% if movie.genre %}
                        <span class="movie-genre">{{ movie.genre }}</span>
                        {% endif %}
                        {% if movie.recommendation_type %}
                        <span class="recommendation-type {{ movie.recommendation_type }}">
                            {{ movie.recommendation_type|title }}
                        </span>
                        {% endif %}
                    </div>
                    
                    <h3 class="movie-title">{{ movie.title }}</h3>
                    
                    {% if movie.vote_average %}
                    <div class="movie-rating-info">
                        <i class="fas fa-star"></i>
                        <span>{{ "%.1f"|format(movie.vote_average) }}</span>
                    </div>
                    {% endif %}
                    
                    {% if movie.release_date %}
                    <div class="movie-year-info">{{ movie.release_date[:4] }}</div>
                    {% endif %}
                    
                    {% if movie.overview %}
                    <p class="movie-overview">{{ movie.overview[:200] }}{% if movie.overview|length > 200 %}...{% endif %}</p>
                    {% endif %}
                    
                    <div class="movie-actions">
                        <button class="btn btn-outline btn-small" onclick="shareMovie('{{ movie.title }}')">
                            <i class="fas fa-share"></i>
                            Share
                        </button>
                        <a href="#" class="btn btn-primary btn-small">
                            <i class="fas fa-info-circle"></i>
                            More Info
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="recommendations-actions">
            <a href="{{ url_for('rate_movies') }}" class="btn btn-primary btn-large">
                <i class="fas fa-star"></i>
                Rate More Movies
            </a>
            <a href="{{ url_for('home') }}" class="btn btn-outline btn-large">
                <i class="fas fa-home"></i>
                Back to Home
            </a>
        </div>
        
        {% else %}
        <div class="empty-state">
            <i class="fas fa-lightbulb"></i>
            <h3>No Recommendations Yet</h3>
            <p>Rate some movies first to get personalized recommendations!</p>
            <a href="{{ url_for('rate_movies') }}" class="btn btn-primary btn-large">
                <i class="fas fa-star"></i>
                Start Rating Movies
            </a>
        </div>
        {% endif %}
    </div>
</div>

<script>
function shareMovie(movieTitle) {
    if (navigator.share) {
        navigator.share({
            title: 'Lumora Recommendation',
            text: `Check out "${movieTitle}" - recommended by Lumora!`,
            url: window.location.href
        });
    } else {
        // Fallback for browsers that don't support Web Share API
        const text = `Check out "${movieTitle}" - recommended by Lumora!`;
        if (navigator.clipboard) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Recommendation copied to clipboard!');
            });
        } else {
            alert(text);
        }
    }
}
</script>
{% endblock %} 